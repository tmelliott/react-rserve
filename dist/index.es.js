import e,{useEffect as r}from"react";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n={exports:{}};n.exports=function(){var e="1.13.4",r="object"==typeof self&&self.self===self&&self||"object"==typeof t&&t.global===t&&t||Function("return this")()||{},n=Array.prototype,a=Object.prototype,i="undefined"!=typeof Symbol?Symbol.prototype:null,u=n.push,o=n.slice,s=a.toString,f=a.hasOwnProperty,c="undefined"!=typeof ArrayBuffer,l="undefined"!=typeof DataView,_=Array.isArray,v=Object.keys,h=Object.create,d=c&&ArrayBuffer.isView,p=isNaN,R=isFinite,g=!{toString:null}.propertyIsEnumerable("toString"),y=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],b=Math.pow(2,53)-1;function m(e,r){return r=null==r?e.length-1:+r,function(){for(var t=Math.max(arguments.length-r,0),n=Array(t),a=0;a<t;a++)n[a]=arguments[a+r];switch(r){case 0:return e.call(this,n);case 1:return e.call(this,arguments[0],n);case 2:return e.call(this,arguments[0],arguments[1],n)}var i=Array(r+1);for(a=0;a<r;a++)i[a]=arguments[a];return i[r]=n,e.apply(this,i)}}function A(e){var r=typeof e;return"function"===r||"object"===r&&!!e}function T(e){return null===e}function w(e){return void 0===e}function E(e){return!0===e||!1===e||"[object Boolean]"===s.call(e)}function S(e){return!(!e||1!==e.nodeType)}function O(e){var r="[object "+e+"]";return function(e){return s.call(e)===r}}var X=O("String"),C=O("Number"),j=O("Date"),U=O("RegExp"),D=O("Error"),L=O("Symbol"),M=O("ArrayBuffer"),I=O("Function"),B=r.document&&r.document.childNodes;"function"!=typeof/./&&"object"!=typeof Int8Array&&"function"!=typeof B&&(I=function(e){return"function"==typeof e||!1});var N=I,k=O("Object"),x=l&&k(new DataView(new ArrayBuffer(8))),P="undefined"!=typeof Map&&k(new Map),G=O("DataView");function V(e){return null!=e&&N(e.getInt8)&&M(e.buffer)}var Y=x?V:G,F=_||O("Array");function z(e,r){return null!=e&&f.call(e,r)}var H=O("Arguments");!function(){H(arguments)||(H=function(e){return z(e,"callee")})}();var W=H;function q(e){return!L(e)&&R(e)&&!isNaN(parseFloat(e))}function K(e){return C(e)&&p(e)}function $(e){return function(){return e}}function J(e){return function(r){var t=e(r);return"number"==typeof t&&t>=0&&t<=b}}function Q(e){return function(r){return null==r?void 0:r[e]}}var Z=Q("byteLength"),ee=J(Z),re=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;function te(e){return d?d(e)&&!Y(e):ee(e)&&re.test(s.call(e))}var ne=c?te:$(!1),ae=Q("length");function ie(e){for(var r={},t=e.length,n=0;n<t;++n)r[e[n]]=!0;return{contains:function(e){return!0===r[e]},push:function(t){return r[t]=!0,e.push(t)}}}function ue(e,r){r=ie(r);var t=y.length,n=e.constructor,i=N(n)&&n.prototype||a,u="constructor";for(z(e,u)&&!r.contains(u)&&r.push(u);t--;)(u=y[t])in e&&e[u]!==i[u]&&!r.contains(u)&&r.push(u)}function oe(e){if(!A(e))return[];if(v)return v(e);var r=[];for(var t in e)z(e,t)&&r.push(t);return g&&ue(e,r),r}function se(e){if(null==e)return!0;var r=ae(e);return"number"==typeof r&&(F(e)||X(e)||W(e))?0===r:0===ae(oe(e))}function fe(e,r){var t=oe(r),n=t.length;if(null==e)return!n;for(var a=Object(e),i=0;i<n;i++){var u=t[i];if(r[u]!==a[u]||!(u in a))return!1}return!0}function ce(e){return e instanceof ce?e:this instanceof ce?void(this._wrapped=e):new ce(e)}function le(e){return new Uint8Array(e.buffer||e,e.byteOffset||0,Z(e))}ce.VERSION=e,ce.prototype.value=function(){return this._wrapped},ce.prototype.valueOf=ce.prototype.toJSON=ce.prototype.value,ce.prototype.toString=function(){return String(this._wrapped)};var _e="[object DataView]";function ve(e,r,t,n){if(e===r)return 0!==e||1/e==1/r;if(null==e||null==r)return!1;if(e!=e)return r!=r;var a=typeof e;return("function"===a||"object"===a||"object"==typeof r)&&he(e,r,t,n)}function he(e,r,t,n){e instanceof ce&&(e=e._wrapped),r instanceof ce&&(r=r._wrapped);var a=s.call(e);if(a!==s.call(r))return!1;if(x&&"[object Object]"==a&&Y(e)){if(!Y(r))return!1;a=_e}switch(a){case"[object RegExp]":case"[object String]":return""+e==""+r;case"[object Number]":return+e!=+e?+r!=+r:0==+e?1/+e==1/r:+e==+r;case"[object Date]":case"[object Boolean]":return+e==+r;case"[object Symbol]":return i.valueOf.call(e)===i.valueOf.call(r);case"[object ArrayBuffer]":case _e:return he(le(e),le(r),t,n)}var u="[object Array]"===a;if(!u&&ne(e)){if(Z(e)!==Z(r))return!1;if(e.buffer===r.buffer&&e.byteOffset===r.byteOffset)return!0;u=!0}if(!u){if("object"!=typeof e||"object"!=typeof r)return!1;var o=e.constructor,f=r.constructor;if(o!==f&&!(N(o)&&o instanceof o&&N(f)&&f instanceof f)&&"constructor"in e&&"constructor"in r)return!1}n=n||[];for(var c=(t=t||[]).length;c--;)if(t[c]===e)return n[c]===r;if(t.push(e),n.push(r),u){if((c=e.length)!==r.length)return!1;for(;c--;)if(!ve(e[c],r[c],t,n))return!1}else{var l,_=oe(e);if(c=_.length,oe(r).length!==c)return!1;for(;c--;)if(!z(r,l=_[c])||!ve(e[l],r[l],t,n))return!1}return t.pop(),n.pop(),!0}function de(e,r){return ve(e,r)}function pe(e){if(!A(e))return[];var r=[];for(var t in e)r.push(t);return g&&ue(e,r),r}function Re(e){var r=ae(e);return function(t){if(null==t)return!1;var n=pe(t);if(ae(n))return!1;for(var a=0;a<r;a++)if(!N(t[e[a]]))return!1;return e!==Te||!N(t[ge])}}var ge="forEach",ye="has",be=["clear","delete"],me=["get",ye,"set"],Ae=be.concat(ge,me),Te=be.concat(me),we=["add"].concat(be,ge,ye),Ee=P?Re(Ae):O("Map"),Se=P?Re(Te):O("WeakMap"),Oe=P?Re(we):O("Set"),Xe=O("WeakSet");function Ce(e){for(var r=oe(e),t=r.length,n=Array(t),a=0;a<t;a++)n[a]=e[r[a]];return n}function je(e){for(var r=oe(e),t=r.length,n=Array(t),a=0;a<t;a++)n[a]=[r[a],e[r[a]]];return n}function Ue(e){for(var r={},t=oe(e),n=0,a=t.length;n<a;n++)r[e[t[n]]]=t[n];return r}function De(e){var r=[];for(var t in e)N(e[t])&&r.push(t);return r.sort()}function Le(e,r){return function(t){var n=arguments.length;if(r&&(t=Object(t)),n<2||null==t)return t;for(var a=1;a<n;a++)for(var i=arguments[a],u=e(i),o=u.length,s=0;s<o;s++){var f=u[s];r&&void 0!==t[f]||(t[f]=i[f])}return t}}var Me=Le(pe),Ie=Le(oe),Be=Le(pe,!0);function Ne(){return function(){}}function ke(e){if(!A(e))return{};if(h)return h(e);var r=Ne();r.prototype=e;var t=new r;return r.prototype=null,t}function xe(e,r){var t=ke(e);return r&&Ie(t,r),t}function Pe(e){return A(e)?F(e)?e.slice():Me({},e):e}function Ge(e,r){return r(e),e}function Ve(e){return F(e)?e:[e]}function Ye(e){return ce.toPath(e)}function Fe(e,r){for(var t=r.length,n=0;n<t;n++){if(null==e)return;e=e[r[n]]}return t?e:void 0}function ze(e,r,t){var n=Fe(e,Ye(r));return w(n)?t:n}function He(e,r){for(var t=(r=Ye(r)).length,n=0;n<t;n++){var a=r[n];if(!z(e,a))return!1;e=e[a]}return!!t}function We(e){return e}function qe(e){return e=Ie({},e),function(r){return fe(r,e)}}function Ke(e){return e=Ye(e),function(r){return Fe(r,e)}}function $e(e,r,t){if(void 0===r)return e;switch(null==t?3:t){case 1:return function(t){return e.call(r,t)};case 3:return function(t,n,a){return e.call(r,t,n,a)};case 4:return function(t,n,a,i){return e.call(r,t,n,a,i)}}return function(){return e.apply(r,arguments)}}function Je(e,r,t){return null==e?We:N(e)?$e(e,r,t):A(e)&&!F(e)?qe(e):Ke(e)}function Qe(e,r){return Je(e,r,1/0)}function Ze(e,r,t){return ce.iteratee!==Qe?ce.iteratee(e,r):Je(e,r,t)}function er(e,r,t){r=Ze(r,t);for(var n=oe(e),a=n.length,i={},u=0;u<a;u++){var o=n[u];i[o]=r(e[o],o,e)}return i}function rr(){}function tr(e){return null==e?rr:function(r){return ze(e,r)}}function nr(e,r,t){var n=Array(Math.max(0,e));r=$e(r,t,1);for(var a=0;a<e;a++)n[a]=r(a);return n}function ar(e,r){return null==r&&(r=e,e=0),e+Math.floor(Math.random()*(r-e+1))}ce.toPath=Ve,ce.iteratee=Qe;var ir=Date.now||function(){return(new Date).getTime()};function ur(e){var r=function(r){return e[r]},t="(?:"+oe(e).join("|")+")",n=RegExp(t),a=RegExp(t,"g");return function(e){return e=null==e?"":""+e,n.test(e)?e.replace(a,r):e}}var or={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},sr=ur(or),fr=ur(Ue(or)),cr=ce.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},lr=/(.)^/,_r={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},vr=/\\|'|\r|\n|\u2028|\u2029/g;function hr(e){return"\\"+_r[e]}var dr=/^\s*(\w|\$)+\s*$/;function pr(e,r,t){!r&&t&&(r=t),r=Be({},r,ce.templateSettings);var n=RegExp([(r.escape||lr).source,(r.interpolate||lr).source,(r.evaluate||lr).source].join("|")+"|$","g"),a=0,i="__p+='";e.replace(n,(function(r,t,n,u,o){return i+=e.slice(a,o).replace(vr,hr),a=o+r.length,t?i+="'+\n((__t=("+t+"))==null?'':_.escape(__t))+\n'":n?i+="'+\n((__t=("+n+"))==null?'':__t)+\n'":u&&(i+="';\n"+u+"\n__p+='"),r})),i+="';\n";var u,o=r.variable;if(o){if(!dr.test(o))throw new Error("variable is not a bare identifier: "+o)}else i="with(obj||{}){\n"+i+"}\n",o="obj";i="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+i+"return __p;\n";try{u=new Function(o,"_",i)}catch(e){throw e.source=i,e}var s=function(e){return u.call(this,e,ce)};return s.source="function("+o+"){\n"+i+"}",s}function Rr(e,r,t){var n=(r=Ye(r)).length;if(!n)return N(t)?t.call(e):t;for(var a=0;a<n;a++){var i=null==e?void 0:e[r[a]];void 0===i&&(i=t,a=n),e=N(i)?i.call(e):i}return e}var gr=0;function yr(e){var r=++gr+"";return e?e+r:r}function br(e){var r=ce(e);return r._chain=!0,r}function mr(e,r,t,n,a){if(!(n instanceof r))return e.apply(t,a);var i=ke(e.prototype),u=e.apply(i,a);return A(u)?u:i}var Ar=m((function(e,r){var t=Ar.placeholder,n=function(){for(var a=0,i=r.length,u=Array(i),o=0;o<i;o++)u[o]=r[o]===t?arguments[a++]:r[o];for(;a<arguments.length;)u.push(arguments[a++]);return mr(e,n,this,this,u)};return n}));Ar.placeholder=ce;var Tr=m((function(e,r,t){if(!N(e))throw new TypeError("Bind must be called on a function");var n=m((function(a){return mr(e,n,r,this,t.concat(a))}));return n})),wr=J(ae);function Er(e,r,t,n){if(n=n||[],r||0===r){if(r<=0)return n.concat(e)}else r=1/0;for(var a=n.length,i=0,u=ae(e);i<u;i++){var o=e[i];if(wr(o)&&(F(o)||W(o)))if(r>1)Er(o,r-1,t,n),a=n.length;else for(var s=0,f=o.length;s<f;)n[a++]=o[s++];else t||(n[a++]=o)}return n}var Sr=m((function(e,r){var t=(r=Er(r,!1,!1)).length;if(t<1)throw new Error("bindAll must be passed function names");for(;t--;){var n=r[t];e[n]=Tr(e[n],e)}return e}));function Or(e,r){var t=function(n){var a=t.cache,i=""+(r?r.apply(this,arguments):n);return z(a,i)||(a[i]=e.apply(this,arguments)),a[i]};return t.cache={},t}var Xr=m((function(e,r,t){return setTimeout((function(){return e.apply(null,t)}),r)})),Cr=Ar(Xr,ce,1);function jr(e,r,t){var n,a,i,u,o=0;t||(t={});var s=function(){o=!1===t.leading?0:ir(),n=null,u=e.apply(a,i),n||(a=i=null)},f=function(){var f=ir();o||!1!==t.leading||(o=f);var c=r-(f-o);return a=this,i=arguments,c<=0||c>r?(n&&(clearTimeout(n),n=null),o=f,u=e.apply(a,i),n||(a=i=null)):n||!1===t.trailing||(n=setTimeout(s,c)),u};return f.cancel=function(){clearTimeout(n),o=0,n=a=i=null},f}function Ur(e,r,t){var n,a,i,u,o,s=function(){var f=ir()-a;r>f?n=setTimeout(s,r-f):(n=null,t||(u=e.apply(o,i)),n||(i=o=null))},f=m((function(f){return o=this,i=f,a=ir(),n||(n=setTimeout(s,r),t&&(u=e.apply(o,i))),u}));return f.cancel=function(){clearTimeout(n),n=i=o=null},f}function Dr(e,r){return Ar(r,e)}function Lr(e){return function(){return!e.apply(this,arguments)}}function Mr(){var e=arguments,r=e.length-1;return function(){for(var t=r,n=e[r].apply(this,arguments);t--;)n=e[t].call(this,n);return n}}function Ir(e,r){return function(){if(--e<1)return r.apply(this,arguments)}}function Br(e,r){var t;return function(){return--e>0&&(t=r.apply(this,arguments)),e<=1&&(r=null),t}}var Nr=Ar(Br,2);function kr(e,r,t){r=Ze(r,t);for(var n,a=oe(e),i=0,u=a.length;i<u;i++)if(r(e[n=a[i]],n,e))return n}function xr(e){return function(r,t,n){t=Ze(t,n);for(var a=ae(r),i=e>0?0:a-1;i>=0&&i<a;i+=e)if(t(r[i],i,r))return i;return-1}}var Pr=xr(1),Gr=xr(-1);function Vr(e,r,t,n){for(var a=(t=Ze(t,n,1))(r),i=0,u=ae(e);i<u;){var o=Math.floor((i+u)/2);t(e[o])<a?i=o+1:u=o}return i}function Yr(e,r,t){return function(n,a,i){var u=0,s=ae(n);if("number"==typeof i)e>0?u=i>=0?i:Math.max(i+s,u):s=i>=0?Math.min(i+1,s):i+s+1;else if(t&&i&&s)return n[i=t(n,a)]===a?i:-1;if(a!=a)return(i=r(o.call(n,u,s),K))>=0?i+u:-1;for(i=e>0?u:s-1;i>=0&&i<s;i+=e)if(n[i]===a)return i;return-1}}var Fr=Yr(1,Pr,Vr),zr=Yr(-1,Gr);function Hr(e,r,t){var n=(wr(e)?Pr:kr)(e,r,t);if(void 0!==n&&-1!==n)return e[n]}function Wr(e,r){return Hr(e,qe(r))}function qr(e,r,t){var n,a;if(r=$e(r,t),wr(e))for(n=0,a=e.length;n<a;n++)r(e[n],n,e);else{var i=oe(e);for(n=0,a=i.length;n<a;n++)r(e[i[n]],i[n],e)}return e}function Kr(e,r,t){r=Ze(r,t);for(var n=!wr(e)&&oe(e),a=(n||e).length,i=Array(a),u=0;u<a;u++){var o=n?n[u]:u;i[u]=r(e[o],o,e)}return i}function $r(e){var r=function(r,t,n,a){var i=!wr(r)&&oe(r),u=(i||r).length,o=e>0?0:u-1;for(a||(n=r[i?i[o]:o],o+=e);o>=0&&o<u;o+=e){var s=i?i[o]:o;n=t(n,r[s],s,r)}return n};return function(e,t,n,a){var i=arguments.length>=3;return r(e,$e(t,a,4),n,i)}}var Jr=$r(1),Qr=$r(-1);function Zr(e,r,t){var n=[];return r=Ze(r,t),qr(e,(function(e,t,a){r(e,t,a)&&n.push(e)})),n}function et(e,r,t){return Zr(e,Lr(Ze(r)),t)}function rt(e,r,t){r=Ze(r,t);for(var n=!wr(e)&&oe(e),a=(n||e).length,i=0;i<a;i++){var u=n?n[i]:i;if(!r(e[u],u,e))return!1}return!0}function tt(e,r,t){r=Ze(r,t);for(var n=!wr(e)&&oe(e),a=(n||e).length,i=0;i<a;i++){var u=n?n[i]:i;if(r(e[u],u,e))return!0}return!1}function nt(e,r,t,n){return wr(e)||(e=Ce(e)),("number"!=typeof t||n)&&(t=0),Fr(e,r,t)>=0}var at=m((function(e,r,t){var n,a;return N(r)?a=r:(r=Ye(r),n=r.slice(0,-1),r=r[r.length-1]),Kr(e,(function(e){var i=a;if(!i){if(n&&n.length&&(e=Fe(e,n)),null==e)return;i=e[r]}return null==i?i:i.apply(e,t)}))}));function it(e,r){return Kr(e,Ke(r))}function ut(e,r){return Zr(e,qe(r))}function ot(e,r,t){var n,a,i=-1/0,u=-1/0;if(null==r||"number"==typeof r&&"object"!=typeof e[0]&&null!=e)for(var o=0,s=(e=wr(e)?e:Ce(e)).length;o<s;o++)null!=(n=e[o])&&n>i&&(i=n);else r=Ze(r,t),qr(e,(function(e,t,n){((a=r(e,t,n))>u||a===-1/0&&i===-1/0)&&(i=e,u=a)}));return i}function st(e,r,t){var n,a,i=1/0,u=1/0;if(null==r||"number"==typeof r&&"object"!=typeof e[0]&&null!=e)for(var o=0,s=(e=wr(e)?e:Ce(e)).length;o<s;o++)null!=(n=e[o])&&n<i&&(i=n);else r=Ze(r,t),qr(e,(function(e,t,n){((a=r(e,t,n))<u||a===1/0&&i===1/0)&&(i=e,u=a)}));return i}var ft=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function ct(e){return e?F(e)?o.call(e):X(e)?e.match(ft):wr(e)?Kr(e,We):Ce(e):[]}function lt(e,r,t){if(null==r||t)return wr(e)||(e=Ce(e)),e[ar(e.length-1)];var n=ct(e),a=ae(n);r=Math.max(Math.min(r,a),0);for(var i=a-1,u=0;u<r;u++){var o=ar(u,i),s=n[u];n[u]=n[o],n[o]=s}return n.slice(0,r)}function _t(e){return lt(e,1/0)}function vt(e,r,t){var n=0;return r=Ze(r,t),it(Kr(e,(function(e,t,a){return{value:e,index:n++,criteria:r(e,t,a)}})).sort((function(e,r){var t=e.criteria,n=r.criteria;if(t!==n){if(t>n||void 0===t)return 1;if(t<n||void 0===n)return-1}return e.index-r.index})),"value")}function ht(e,r){return function(t,n,a){var i=r?[[],[]]:{};return n=Ze(n,a),qr(t,(function(r,a){var u=n(r,a,t);e(i,r,u)})),i}}var dt=ht((function(e,r,t){z(e,t)?e[t].push(r):e[t]=[r]})),pt=ht((function(e,r,t){e[t]=r})),Rt=ht((function(e,r,t){z(e,t)?e[t]++:e[t]=1})),gt=ht((function(e,r,t){e[t?0:1].push(r)}),!0);function yt(e){return null==e?0:wr(e)?e.length:oe(e).length}function bt(e,r,t){return r in t}var mt=m((function(e,r){var t={},n=r[0];if(null==e)return t;N(n)?(r.length>1&&(n=$e(n,r[1])),r=pe(e)):(n=bt,r=Er(r,!1,!1),e=Object(e));for(var a=0,i=r.length;a<i;a++){var u=r[a],o=e[u];n(o,u,e)&&(t[u]=o)}return t})),At=m((function(e,r){var t,n=r[0];return N(n)?(n=Lr(n),r.length>1&&(t=r[1])):(r=Kr(Er(r,!1,!1),String),n=function(e,t){return!nt(r,t)}),mt(e,n,t)}));function Tt(e,r,t){return o.call(e,0,Math.max(0,e.length-(null==r||t?1:r)))}function wt(e,r,t){return null==e||e.length<1?null==r||t?void 0:[]:null==r||t?e[0]:Tt(e,e.length-r)}function Et(e,r,t){return o.call(e,null==r||t?1:r)}function St(e,r,t){return null==e||e.length<1?null==r||t?void 0:[]:null==r||t?e[e.length-1]:Et(e,Math.max(0,e.length-r))}function Ot(e){return Zr(e,Boolean)}function Xt(e,r){return Er(e,r,!1)}var Ct=m((function(e,r){return r=Er(r,!0,!0),Zr(e,(function(e){return!nt(r,e)}))})),jt=m((function(e,r){return Ct(e,r)}));function Ut(e,r,t,n){E(r)||(n=t,t=r,r=!1),null!=t&&(t=Ze(t,n));for(var a=[],i=[],u=0,o=ae(e);u<o;u++){var s=e[u],f=t?t(s,u,e):s;r&&!t?(u&&i===f||a.push(s),i=f):t?nt(i,f)||(i.push(f),a.push(s)):nt(a,s)||a.push(s)}return a}var Dt=m((function(e){return Ut(Er(e,!0,!0))}));function Lt(e){for(var r=[],t=arguments.length,n=0,a=ae(e);n<a;n++){var i=e[n];if(!nt(r,i)){var u;for(u=1;u<t&&nt(arguments[u],i);u++);u===t&&r.push(i)}}return r}function Mt(e){for(var r=e&&ot(e,ae).length||0,t=Array(r),n=0;n<r;n++)t[n]=it(e,n);return t}var It=m(Mt);function Bt(e,r){for(var t={},n=0,a=ae(e);n<a;n++)r?t[e[n]]=r[n]:t[e[n][0]]=e[n][1];return t}function Nt(e,r,t){null==r&&(r=e||0,e=0),t||(t=r<e?-1:1);for(var n=Math.max(Math.ceil((r-e)/t),0),a=Array(n),i=0;i<n;i++,e+=t)a[i]=e;return a}function kt(e,r){if(null==r||r<1)return[];for(var t=[],n=0,a=e.length;n<a;)t.push(o.call(e,n,n+=r));return t}function xt(e,r){return e._chain?ce(r).chain():r}function Pt(e){return qr(De(e),(function(r){var t=ce[r]=e[r];ce.prototype[r]=function(){var e=[this._wrapped];return u.apply(e,arguments),xt(this,t.apply(ce,e))}})),ce}qr(["pop","push","reverse","shift","sort","splice","unshift"],(function(e){var r=n[e];ce.prototype[e]=function(){var t=this._wrapped;return null!=t&&(r.apply(t,arguments),"shift"!==e&&"splice"!==e||0!==t.length||delete t[0]),xt(this,t)}})),qr(["concat","join","slice"],(function(e){var r=n[e];ce.prototype[e]=function(){var e=this._wrapped;return null!=e&&(e=r.apply(e,arguments)),xt(this,e)}}));var Gt=Pt({__proto__:null,VERSION:e,restArguments:m,isObject:A,isNull:T,isUndefined:w,isBoolean:E,isElement:S,isString:X,isNumber:C,isDate:j,isRegExp:U,isError:D,isSymbol:L,isArrayBuffer:M,isDataView:Y,isArray:F,isFunction:N,isArguments:W,isFinite:q,isNaN:K,isTypedArray:ne,isEmpty:se,isMatch:fe,isEqual:de,isMap:Ee,isWeakMap:Se,isSet:Oe,isWeakSet:Xe,keys:oe,allKeys:pe,values:Ce,pairs:je,invert:Ue,functions:De,methods:De,extend:Me,extendOwn:Ie,assign:Ie,defaults:Be,create:xe,clone:Pe,tap:Ge,get:ze,has:He,mapObject:er,identity:We,constant:$,noop:rr,toPath:Ve,property:Ke,propertyOf:tr,matcher:qe,matches:qe,times:nr,random:ar,now:ir,escape:sr,unescape:fr,templateSettings:cr,template:pr,result:Rr,uniqueId:yr,chain:br,iteratee:Qe,partial:Ar,bind:Tr,bindAll:Sr,memoize:Or,delay:Xr,defer:Cr,throttle:jr,debounce:Ur,wrap:Dr,negate:Lr,compose:Mr,after:Ir,before:Br,once:Nr,findKey:kr,findIndex:Pr,findLastIndex:Gr,sortedIndex:Vr,indexOf:Fr,lastIndexOf:zr,find:Hr,detect:Hr,findWhere:Wr,each:qr,forEach:qr,map:Kr,collect:Kr,reduce:Jr,foldl:Jr,inject:Jr,reduceRight:Qr,foldr:Qr,filter:Zr,select:Zr,reject:et,every:rt,all:rt,some:tt,any:tt,contains:nt,includes:nt,include:nt,invoke:at,pluck:it,where:ut,max:ot,min:st,shuffle:_t,sample:lt,sortBy:vt,groupBy:dt,indexBy:pt,countBy:Rt,partition:gt,toArray:ct,size:yt,pick:mt,omit:At,first:wt,head:wt,take:wt,initial:Tt,last:St,rest:Et,tail:Et,drop:Et,compact:Ot,flatten:Xt,without:jt,uniq:Ut,unique:Ut,union:Dt,intersection:Lt,difference:Ct,unzip:Mt,transpose:Mt,zip:It,object:Bt,range:Nt,chunk:kt,mixin:Pt,default:ce});return Gt._=Gt,Gt}();const a=function(){var e,r={},t=n.exports;return function(){function e(e,r){r=r||{json:function(){throw"json() unsupported for type "+this.type}};var n={json:function(n){var a=r.json.call(this,n);return a.r_type=e,t.isUndefined(this.attributes)||(a.r_attributes=t.object(t.map(this.attributes.value,(function(e){return[e.name,e.value.json(n)]})))),a}};return function(r,t){function a(){this.type=e,this.value=r,this.attributes=t}return a.prototype=n,new a}}r.Robj={null:function(e){return{type:"null",value:null,attributes:e,json:function(){return null}}},clos:function(e,r,t){return{type:"clos",value:{formals:e,body:r},attributes:t,json:function(){throw"json() unsupported for type clos"}}},vector:e("vector",{json:function(e){var r=t.map(this.value,(function(r){return r.json(e)}));if(t.isUndefined(this.attributes))return r;if("names"==this.attributes.value[0].name){var n=this.attributes.value[0].value.value,a={};return t.each(n,(function(e,t){a[e]=r[t]})),a}return r}}),symbol:e("symbol",{json:function(){return this.value}}),list:e("list"),lang:e("lang",{json:function(e){var r=t.map(this.value,(function(r){return r.json(e)}));if(t.isUndefined(this.attributes))return r;if("names"!=this.attributes.value[0].name)throw"expected names here";var n=this.attributes.value[0].value.value,a={};return t.each(n,(function(e,t){a[e]=r[t]})),a}}),tagged_list:e("tagged_list",{json:function(e){var r=this.value.slice(1);switch(function(e){return t.all(e,(function(e){return null===e.name}))?"plain_list":t.all(e,(function(e){return null!==e.name}))?"plain_object":"mixed_list"}(r)){case"plain_list":return t.map(r,(function(r){return r.value.json(e)}));case"plain_object":return t.object(t.map(r,(function(r){return[r.name,r.value.json(e)]})));case"mixed_list":return r;default:throw"Internal Error"}}}),tagged_lang:e("tagged_lang",{json:function(e){return t.map(this.value,(function(r){return[r.name,r.value.json(e)]}))}}),vector_exp:e("vector_exp"),int_array:e("int_array",{json:function(){if(this.attributes&&"tagged_list"===this.attributes.type&&"levels"===this.attributes.value[0].name&&"string_array"===this.attributes.value[0].value.type){var e=this.attributes.value[0].value.value,r=t.map(this.value,(function(r){return e[r-1]}));return r.levels=e,r}return 1===this.value.length?this.value[0]:this.value}}),double_array:e("double_array",{json:function(){return 1===this.value.length&&t.isUndefined(this.attributes)?this.value[0]:this.value}}),string_array:e("string_array",{json:function(e){return 1===this.value.length?t.isUndefined(this.attributes)?this.value[0]:"class"===this.attributes.value[0].name&&-1!==this.attributes.value[0].value.value.indexOf("javascript_function")?e(this.value[0]):this.value:this.value}}),bool_array:e("bool_array",{json:function(){return 1===this.value.length&&t.isUndefined(this.attributes)?this.value[0]:this.value}}),raw:e("raw",{json:function(){return 1===this.value.length&&t.isUndefined(this.attributes)?this.value[0]:this.value}}),string:e("string",{json:function(){return this.value}})}}(),r.Rsrv={PAR_TYPE:function(e){return 255&e},PAR_LEN:function(e){return e>>>8},PAR_LENGTH:function(e){return e>>>8},par_parse:function(e){return[r.Rsrv.PAR_TYPE(e),r.Rsrv.PAR_LEN(e)]},SET_PAR:function(e,r){return(16777215&r)<<8|255&e},CMD_STAT:function(e){return e>>>24&127},SET_STAT:function(e,r){return e|(127&r)<<24},IS_OOB_SEND:function(e){return(268431360&e)===r.Rsrv.OOB_SEND},IS_OOB_MSG:function(e){return(268431360&e)===r.Rsrv.OOB_MSG},OOB_USR_CODE:function(e){return 4095&e},CMD_RESP:65536,RESP_OK:65537,RESP_ERR:65538,OOB_SEND:135168,OOB_MSG:139264,ERR_auth_failed:65,ERR_conn_broken:66,ERR_inv_cmd:67,ERR_inv_par:68,ERR_Rerror:69,ERR_IOerror:70,ERR_notOpen:71,ERR_accessDenied:72,ERR_unsupportedCmd:73,ERR_unknownCmd:74,ERR_data_overflow:75,ERR_object_too_big:76,ERR_out_of_mem:77,ERR_ctrl_closed:78,ERR_session_busy:80,ERR_detach_failed:81,ERR_disabled:97,ERR_unavailable:98,ERR_cryptError:99,ERR_securityClose:100,CMD_login:1,CMD_voidEval:2,CMD_eval:3,CMD_shutdown:4,CMD_switch:5,CMD_keyReq:6,CMD_secLogin:7,CMD_OCcall:15,CMD_openFile:16,CMD_createFile:17,CMD_closeFile:18,CMD_readFile:19,CMD_writeFile:20,CMD_removeFile:21,CMD_setSEXP:32,CMD_assignSEXP:33,CMD_detachSession:48,CMD_detachedVoidEval:49,CMD_attachSession:50,CMD_ctrl:64,CMD_ctrlEval:66,CMD_ctrlSource:69,CMD_ctrlShutdown:68,CMD_setBufferSize:129,CMD_setEncoding:130,CMD_SPECIAL_MASK:240,CMD_serEval:245,CMD_serAssign:246,CMD_serEEval:247,DT_INT:1,DT_CHAR:2,DT_DOUBLE:3,DT_STRING:4,DT_BYTESTREAM:5,DT_SEXP:10,DT_ARRAY:11,DT_LARGE:64,XT_NULL:0,XT_INT:1,XT_DOUBLE:2,XT_STR:3,XT_LANG:4,XT_SYM:5,XT_BOOL:6,XT_S4:7,XT_VECTOR:16,XT_LIST:17,XT_CLOS:18,XT_SYMNAME:19,XT_LIST_NOTAG:20,XT_LIST_TAG:21,XT_LANG_NOTAG:22,XT_LANG_TAG:23,XT_VECTOR_EXP:26,XT_VECTOR_STR:27,XT_ARRAY_INT:32,XT_ARRAY_DOUBLE:33,XT_ARRAY_STR:34,XT_ARRAY_BOOL_UA:35,XT_ARRAY_BOOL:36,XT_RAW:37,XT_ARRAY_CPLX:38,XT_UNKNOWN:48,XT_LARGE:64,XT_HAS_ATTR:128,BOOL_TRUE:1,BOOL_FALSE:0,BOOL_NA:2,GET_XT:function(e){return 63&e},GET_DT:function(e){return 63&e},HAS_ATTR:function(e){return(e&r.Rsrv.XT_HAS_ATTR)>0},IS_LARGE:function(e){return(e&r.Rsrv.XT_LARGE)>0},status_codes:{65:"ERR_auth_failed",66:"ERR_conn_broken",67:"ERR_inv_cmd",68:"ERR_inv_par",69:"ERR_Rerror",70:"ERR_IOerror",71:"ERR_notOpen",72:"ERR_accessDenied",73:"ERR_unsupportedCmd",74:"ERR_unknownCmd",75:"ERR_data_overflow",76:"ERR_object_too_big",77:"ERR_out_of_mem",78:"ERR_ctrl_closed",80:"ERR_session_busy",81:"ERR_detach_failed",97:"ERR_disabled",98:"ERR_unavailable",99:"ERR_cryptError",100:"ERR_securityClose"}},function(){function e(e){var n={};function a(e,r){return function(t,n){return[e.call(s,t,n),r||n]}}function i(e,r){return function(t,n){var a=e.call(s,t,n),i=r(a[0])(t,n-a[1]);return[i[0],a[1]+i[1]]}}function u(e){if(1===e.length&&255===e.charCodeAt(0))return null;try{return decodeURIComponent(escape(e))}catch(r){throw new Error("Invalid UTF8: "+e)}}var o,s={offset:0,data_view:e.make(r.EndianAwareDataView),msg:e,read_int:function(){var e=this.offset;return this.offset+=4,this.data_view.getInt32(e)},read_string:function(e){for(var r="";e--;){var t=this.data_view.getInt8(this.offset++);t&&(r+=String.fromCharCode(t))}return u(r)},read_stream:function(e){var r=this.offset;return this.offset+=e,this.msg.view(r,e)},read_int_vector:function(e){var r=this.offset;return this.offset+=e,this.msg.make(Int32Array,r,e)},read_double_vector:function(e){var r=this.offset;return this.offset+=e,this.msg.make(Float64Array,r,e)},read_null:a((function(e,t){return r.Robj.null(e)})),read_unknown:a((function(e,t){return this.offset+=t,r.Robj.null(e)})),read_string_array:function(e,t){for(var n=this.read_stream(t).make(Uint8Array),a=[],i="",o=0;o<n.length;++o)0===n[o]?(i=u(i),a.push(i),i=""):i+=String.fromCharCode(n[o]);return[r.Robj.string_array(a,e),t]},read_bool_array:function(e,n){var a=this.read_int(),i=this.read_stream(n-4),u=t.map(i.make(Uint8Array).subarray(0,a),(function(e){return!!e}));return[r.Robj.bool_array(u,e),n]},read_raw:function(e,t){var n=this.read_int(),a=this.read_stream(t-4),i=new Uint8Array(a.make(Uint8Array).subarray(0,n)).buffer;return[r.Robj.raw(i,e),t]},read_sexp:function(){var e=this.read_int(),t=r.Rsrv.par_parse(e),a=t[0],i=t[1],u=4,o=void 0;r.Rsrv.IS_LARGE(a)&&(u+=4,i+=this.read_int()*Math.pow(2,24),a&=-65);if(a&r.Rsrv.XT_HAS_ATTR){a&=~r.Rsrv.XT_HAS_ATTR;var s=this.read_sexp();o=s[0],u+=s[1],i-=s[1]}if(void 0===n[a])throw new r.RserveError("Unimplemented "+a,-1);var f=n[a].call(this,o,i);return[f[0],u+f[1]]}};function f(e){for(var r=[],t=0;t<e.length;t+=2){var n=e[t],a=e[t+1];"symbol"===a.type?r.push({name:a.value,value:n}):r.push({name:null,value:n})}return r}function c(e,r){return i(e,(function(e){return a((function(t,n){return r(e,t)}),0)}))}function l(e,r){return a((function(t,n){return r(e.call(s,n),t)}))}return s.read_clos=i(s.read_sexp,(function(e){return i(s.read_sexp,(function(t){return a((function(n,a){return r.Robj.clos(e,t,n)}),0)}))})),s.read_list=(o=s.read_sexp,function(e,r){for(var t=[],n=r;r>0;){var a=o.call(s,e,r);t.push(a[0]),r-=a[1]}return[t,n]}),s.read_list_tag=i(s.read_list,(function(e){return a((function(t,n){var a=f(e);return r.Robj.tagged_list(a,t)}),0)})),s.read_lang_tag=i(s.read_list,(function(e){return a((function(t,n){var a=f(e);return r.Robj.tagged_lang(a,t)}),0)})),s.read_vector=c(s.read_list,r.Robj.vector),s.read_list_no_tag=c(s.read_list,r.Robj.list),s.read_lang_no_tag=c(s.read_list,r.Robj.lang),s.read_vector_exp=c(s.read_list,r.Robj.vector_exp),s.read_symname=l(s.read_string,r.Robj.symbol),s.read_int_array=l(s.read_int_vector,r.Robj.int_array),s.read_double_array=l(s.read_double_vector,r.Robj.double_array),n[r.Rsrv.XT_NULL]=s.read_null,n[r.Rsrv.XT_UNKNOWN]=s.read_unknown,n[r.Rsrv.XT_VECTOR]=s.read_vector,n[r.Rsrv.XT_CLOS]=s.read_clos,n[r.Rsrv.XT_SYMNAME]=s.read_symname,n[r.Rsrv.XT_LIST_NOTAG]=s.read_list_no_tag,n[r.Rsrv.XT_LIST_TAG]=s.read_list_tag,n[r.Rsrv.XT_LANG_NOTAG]=s.read_lang_no_tag,n[r.Rsrv.XT_LANG_TAG]=s.read_lang_tag,n[r.Rsrv.XT_VECTOR_EXP]=s.read_vector_exp,n[r.Rsrv.XT_ARRAY_INT]=s.read_int_array,n[r.Rsrv.XT_ARRAY_DOUBLE]=s.read_double_array,n[r.Rsrv.XT_ARRAY_STR]=s.read_string_array,n[r.Rsrv.XT_ARRAY_BOOL]=s.read_bool_array,n[r.Rsrv.XT_RAW]=s.read_raw,n[r.Rsrv.XT_STR]=l(s.read_string,r.Robj.string),s}var n=[],a=null,i=0,u=0;function o(){n=[],a=null,u=0,i=0}function s(t){var n=r.my_ArrayBufferView(t,16,t.byteLength-16);if(0===n.length)return null;var a=e(n),i=a.read_int(),u=r.Rsrv.par_parse(i),o=u[0],s=u[1];if(r.Rsrv.IS_LARGE(o)){if((s+=a.read_int()*Math.pow(2,24))>Math.pow(2,32))throw new Error("Payload too large: "+s+" bytes");o&=-65}if(o===r.Rsrv.DT_INT)return{type:"int",value:a.read_int()};if(o===r.Rsrv.DT_STRING)return{type:"string",value:a.read_string(s)};if(o===r.Rsrv.DT_BYTESTREAM)return{type:"stream",value:a.read_stream(s)};if(o===r.Rsrv.DT_SEXP){var f=(u=a.read_sexp())[0];return u[1],{type:"sexp",value:f}}throw new r.RserveError("Bad type for parse? "+o+" "+s,-1)}r.parse_websocket_frame=function(e){var t={};if(n.length){if(t.header=a,n.push(e),(u-=e.byteLength)<0)return t.ok=!1,t.message="Messages add up to more than expected length: got "+(i-u)+", expected "+i,o(),t;if(0!==u)return t.ok=!0,t.incomplete=!0,t;var f=new ArrayBuffer(i),c=new Uint8Array(f),l=0;if(n.forEach((function(e,r){c.set(new Uint8Array(e),l),l+=e.byteLength})),l!==i)return t.ok=!1,t.message="Internal error - frames added up to "+l+" not "+i,o(),t;o(),e=f}var _=new Int32Array(e,0,4),v=16777215&_[0],h=_[0]>>>24,d=_[1],p=_[3],R=_[2];if(t.header=[v,h,R],p)return t.ok=!1,t.message="rserve.js cannot handle messages larger than 4GB",t;var g=d+16;if(g>e.byteLength)return n.push(e),a=_,u=(i=g)-e.byteLength,t.header=_,t.ok=!0,t.incomplete=!0,t;if(v===r.Rsrv.RESP_ERR)return t.ok=!1,t.status_code=h,t.message="ERROR FROM R SERVER: "+(r.Rsrv.status_codes[h]||h)+" "+t.header[0]+" "+t.header[1]+" "+e.byteLength+" "+e,t;if(v!==r.Rsrv.RESP_OK&&!r.Rsrv.IS_OOB_SEND(v)&&!r.Rsrv.IS_OOB_MSG(v))return t.ok=!1,t.message="Unexpected response from Rserve: "+v+" status: "+r.Rsrv.status_codes[h],t;try{t.payload=s(e),t.ok=!0}catch(e){t.ok=!1,t.message=e.message}return t},r.parse_payload=s}(),function(){var r=new ArrayBuffer(4),t=new Uint8Array(r),n=new Uint32Array(r);if(t[0]=1,1===n[0])e=!0;else{if(16777216!==n[0])throw"we're bizarro endian, refusing to continue";e=!1}}(),r.EndianAwareDataView=function(){for(var r={setInt8:function(e,r){return this.view.setInt8(e,r)},setUint8:function(e,r){return this.view.setUint8(e,r)},getInt8:function(e){return this.view.getInt8(e)},getUint8:function(e){return this.view.getUint8(e)}},t=["setInt32","setInt16","setUint32","setUint16","setFloat32","setFloat64"],n=["getInt32","getInt16","getUint32","getUint16","getFloat32","getFloat64"],a=0;a<t.length;++a)r[i=t[a]]=function(r){return function(t,n){return this.view[r](t,n,e)}}(i);for(a=0;a<n.length;++a){var i;r[i=n[a]]=function(r){return function(t){return this.view[r](t,e)}}(i)}function u(e,r,t){void 0===r?0===e.byteLength?this.view={byteLength:0,byteOffset:0}:this.view=new DataView(e):this.view=new DataView(e,r,t)}return u.prototype=r,u}(),r.my_ArrayBufferView=function(e,n,a){return{buffer:e,offset:n=t.isUndefined(n)?0:n,length:a=t.isUndefined(a)?e.byteLength:a,data_view:function(){return new r.EndianAwareDataView(this.buffer,this.offset,this.buffer.byteLength-this.offset)},make:function(e,r,n){r=t.isUndefined(r)?0:r,n=t.isUndefined(n)?this.length:n;var a=e.BYTES_PER_ELEMENT||1,i=n/a;if((this.offset+r)%a!=0){for(var u=new DataView(this.buffer,this.offset+r,n),o=new ArrayBuffer(n),s=new DataView(o),f=0;f<n;++f)s.setUint8(f,u.getUint8(f));return new e(o)}return new e(this.buffer,this.offset+r,i)},skip:function(e){return r.my_ArrayBufferView(this.buffer,this.offset+e,this.buffer.byteLength)},view:function(e,t){var n=this.offset+e;if(n+t>this.buffer.byteLength)throw new Error("Rserve.my_ArrayBufferView.view: bounds error: size: "+this.buffer.byteLength+" offset: "+n+" length: "+t);return r.my_ArrayBufferView(this.buffer,n,t)}}},function(){function e(e,n,a){t.isArray(n)||(n=[n]),a||(a=0);var i=t.reduce(n,(function(e,r){return e+r.byteLength}),0),u=new ArrayBuffer(16+i),o=new r.EndianAwareDataView(u);o.setInt32(0,e),o.setInt32(4,i),o.setInt32(8,a),o.setInt32(12,0);var s=16;return t.each(n,(function(e){for(var r=new Uint8Array(e),t=0;t<r.byteLength;++t)o.setUint8(s+t,r[t]);s+=e.byteLength})),u}function n(e){var t=e.length+1+3&-4,n=new ArrayBuffer(t+4),a=new r.EndianAwareDataView(n);a.setInt32(0,r.Rsrv.DT_STRING+(t<<8));for(var i=0;i<e.length;++i)a.setInt8(4+i,e.charCodeAt(i));return n}r.create=function(a){var i=(a=t.defaults(a||{},{host:"http://127.0.0.1:8081",on_connect:function(){}})).host,u=a.on_connect,o=new WebSocket(i);o.binaryType="arraybuffer";var s,f=a.on_error||function(e){throw new r.RserveError(e,-1)},c=!1,l={};function _(e){var r=function(){var e;do{e=String(Math.random()).slice(2,12)}while(e in l);if(10!==e.length)throw new Error("Bad rng, no cookie");return e}();return l[r]=e,r}function v(e,t){var n=r.determine_size(e,t);if(n>16777215){var a=new ArrayBuffer(n+8);return(i=r.my_ArrayBufferView(a)).data_view().setInt32(0,r.Rsrv.DT_SEXP+(16777215&n)*Math.pow(2,8)+r.Rsrv.DT_LARGE),i.data_view().setInt32(4,n>>>24),r.write_into_view(e,i.skip(8),t,_),a}var i;a=new ArrayBuffer(n+4);return(i=r.my_ArrayBufferView(a)).data_view().setInt32(0,r.Rsrv.DT_SEXP+(n<<8)),r.write_into_view(e,i.skip(4),t,_),a}function h(r,t,n){var i=e(r,t,n);return a.debug&&a.debug.message_out&&a.debug.message_out(i[0],r),o.send(i),i}o.onclose=function(e){s.running=!1,s.closed=!0,a.on_close&&a.on_close(e)},o.onmessage=function(e){if("Buffer"===e.data.constructor.name&&(e.data=new Uint8Array(e.data).buffer),a.debug&&a.debug.message_in&&a.debug.message_in(e),c)if("string"!=typeof e.data){var i=r.parse_websocket_frame(e.data);if(!i.incomplete){var o=i.header[2],l=16777215&i.header[0],_=t.find(R,(function(e){return e.msg_id==o}));if(_||(_=R[0]),i.ok)if(l===r.Rsrv.RESP_OK)_.result_callback(null,i.payload);else if(r.Rsrv.IS_OOB_SEND(l))a.on_data&&a.on_data(i.payload);else if(r.Rsrv.IS_OOB_MSG(l)){var g;_=r.Rsrv.OOB_USR_CODE(l)>255?p:d;try{g=r.wrap_all_ocaps(s,i.payload)}catch(e){return void h(r.Rsrv.RESP_ERR|l,n(String(e)),o)}if(t.isString(g[0]))t.isUndefined(a.on_oob_message)?h(r.Rsrv.RESP_ERR|l,n("No handler installed"),o):(_.in_oob_message=!0,a.on_oob_message(i.payload,(function(e,t){_.in_oob_message?(_.in_oob_message=!1,e?h(l|r.Rsrv.RESP_ERR,n(e),o):h(l|r.Rsrv.RESP_OK,n(t),o),y()):f("Don't call oob_message_handler more than once.")})));else if(t.isFunction(g[0]))if(s.ocap_mode){var b=g[0],m=g.slice(1);m.push((function(e,t){e?h(r.Rsrv.RESP_ERR|l,v(e),o):h(l,v(t),o)})),b.apply(void 0,m)}else h(r.Rsrv.RESP_ERROR|l,n("JavaScript function calls only allowed in ocap mode"),o);else h(r.Rsrv.RESP_ERROR|l,n("Unknown oob message type: "+typeof g[0]))}else f("Internal Error, parse returned unexpected type "+i.header[0],-1);else _.result_callback([i.message,i.status_code],void 0)}}else a.on_raw_string&&a.on_raw_string(e.data);else!function(e){if("string"==typeof(e=e.data))"Rsrv"!==e.substr(0,4)?f("server is not an RServe instance",-1):"0103"!==e.substr(4,4)?f("sorry, rserve only speaks the 0103 version of the R server protocol",-1):"QAP1"!==e.substr(8,4)?f("sorry, rserve only speaks QAP1",-1):(c=!0,a.login&&s.login(a.login),s.running=!0,u&&u.call(s));else{var t=new DataView(e),n=String.fromCharCode(t.getUint8(0))+String.fromCharCode(t.getUint8(1))+String.fromCharCode(t.getUint8(2))+String.fromCharCode(t.getUint8(3));"RsOC"===n?(c=!0,s.ocap_mode=!0,s.bare_ocap=r.parse_payload(e).value,s.ocap=r.wrap_ocap(s,s.bare_ocap),s.running=!0,u&&u.call(s)):f("Unrecognized server answer: "+n,-1)}}(e)};var d={queue:[],in_oob_message:!1,awaiting_result:!1,msg_id:0,name:"control"},p={queue:[],in_oob_message:!1,awaiting_result:!1,msg_id:1,name:"compute"},R=[d,p];function g(e){return!e.in_oob_message&&!e.awaiting_result&&e.queue.length}function y(){var e=t.filter(R,g);if(e.length)if(s.closed)f("Cannot send messages on a closed socket!",-1);else{var r=t.sortBy(e,(function(e){return e.queue[0].timestamp}))[0],n=r.queue.shift();r.result_callback=n.callback,r.awaiting_result=!0,a.debug&&a.debug.message_out&&a.debug.message_out(n.buffer,n.command),o.send(n.buffer)}}function b(r,t,n,a,i){return i||(i=R[0]),n=n||function(){},function(e,r,t,n){n.queue.push({buffer:e,callback:function(e,t){n.awaiting_result=!1,y(),r(e,t)},command:t,timestamp:Date.now()}),y()}(e(r,t,i.msg_id),n,a,i)}return s={ocap_mode:!1,running:!1,closed:!1,close:function(){o.close()},login:function(e,t){b(r.Rsrv.CMD_login,n(e),t,e)},eval:function(e,t){b(r.Rsrv.CMD_eval,n(e),t,e)},createFile:function(e,t){b(r.Rsrv.CMD_createFile,n(e),t,e)},writeFile:function(e,t){b(r.Rsrv.CMD_writeFile,function(e){var t=e.length,n=new ArrayBuffer(t+4),a=new r.EndianAwareDataView(n);a.setInt32(0,r.Rsrv.DT_BYTESTREAM+(t<<8));for(var i=0;i<e.length;++i)a.setInt8(4+i,e[i]);return n}(e),t,"")},closeFile:function(e){b(r.Rsrv.CMD_closeFile,new ArrayBuffer(0),e,"")},set:function(e,t,a){b(r.Rsrv.CMD_setSEXP,[n(e),v(t)],a,"")},OCcall:function(e,t,n){var a,i=!1;try{i|="OCref"===e.r_attributes.class,a=e[0]}catch(e){}if(!i)try{i|="OCref"===e.attributes.value[0].value.value[0],a=e.value[0]}catch(e){}if(i){var u=[a];u.push.apply(u,t);var o=64==a.charCodeAt(0)?p:d;b(r.Rsrv.CMD_OCcall,v(u,r.Rsrv.XT_LANG_NOTAG),n,"",o)}else n(new Error("Expected an ocap, instead got "+e),void 0)},wrap_ocap:function(e){return r.wrap_ocap(this,e)},resolve_hash:function(e){if(!(e in l))throw new Error("hash "+e+" not found.");return l[e]}}},r.wrap_all_ocaps=function(e,n){return function n(a){var i=a;if(t.isArray(a)&&a.r_attributes&&"OCref"==a.r_attributes.class)return r.wrap_ocap(e,a);if(t.isArray(a))(i=t.map(a,n)).r_type=a.r_type,i.r_attributes=a.r_attributes;else{if(t.isTypedArray(a))return a;if(t.isFunction(a))return a;if(a&&!t.isUndefined(a.byteLength)&&!t.isUndefined(a.slice))return a;t.isObject(a)&&(i=t.object(t.map(a,(function(e,r){return[r,n(e)]}))))}return i}(n=n.value.json(e.resolve_hash))},r.wrap_ocap=function(e,n){var a=function(){var a=t.toArray(arguments);if(!a.length||!t.isFunction(a[a.length-1]))throw new Error("forgot to pass continuation to ocap");var i=a.pop();e.OCcall(n,a,(function(n,a){t.isUndefined(a)||(a=r.wrap_all_ocaps(e,a)),i(n,a)}))};return a.bare_ocap=n,a}}(),r.RserveError=function(e,r){this.name="RserveError",this.message=e,this.status_code=r},r.RserveError.prototype=Object.create(Error),r.RserveError.prototype.constructor=r.RserveError,t.mixin({isTypedArray:function(e){return!!t.isObject(e)&&!t.isUndefined(e.byteLength)&&!t.isUndefined(e.BYTES_PER_ELEMENT)}}),r.type_id=function(e){if(t.isNull(e)||t.isUndefined(e))return r.Rsrv.XT_NULL;var n={boolean:r.Rsrv.XT_ARRAY_BOOL,number:r.Rsrv.XT_ARRAY_DOUBLE,string:r.Rsrv.XT_ARRAY_STR};if(!t.isUndefined(n[typeof e]))return n[typeof e];if(t.isTypedArray(e))return r.Rsrv.XT_ARRAY_DOUBLE;if(!t.isUndefined(e.byteLength)&&!t.isUndefined(e.slice))return r.Rsrv.XT_RAW;if(t.isArray(e)&&t.all(e,(function(e){return"string"==typeof e})))return r.Rsrv.XT_ARRAY_STR;if(t.isArray(e)&&t.all(e,(function(e){return"boolean"==typeof e})))return r.Rsrv.XT_ARRAY_BOOL;if(t.isArray(e))return r.Rsrv.XT_VECTOR;if(t.isFunction(e))return r.Rsrv.XT_ARRAY_STR|r.Rsrv.XT_HAS_ATTR;if(t.isObject(e))return r.Rsrv.XT_VECTOR|r.Rsrv.XT_HAS_ATTR;throw new r.RServeError("Value type unrecognized by Rserve: "+e)},r.determine_size=function(e,n){function a(e){return t.reduce(e,(function(e,t){return e+r.determine_size(t)}),0)}function i(e){return e>1<<24?e+8:e+4}var u=n||r.type_id(e);switch(u&~r.Rsrv.XT_LARGE){case r.Rsrv.XT_NULL:return i(0);case r.Rsrv.XT_ARRAY_BOOL:return t.isBoolean(e)?i(8):i(e.length+7&-4);case r.Rsrv.XT_ARRAY_STR:return t.isArray(e)?i(t.reduce(e,(function(e,r){return e+unescape(encodeURIComponent(r)).length+1}),0)):i(unescape(encodeURIComponent(e)).length+1);case r.Rsrv.XT_ARRAY_DOUBLE:return t.isNumber(e)?i(8):i(8*e.length);case r.Rsrv.XT_RAW:return i(4+e.byteLength);case r.Rsrv.XT_VECTOR:case r.Rsrv.XT_LANG_NOTAG:return i(a(e));case r.Rsrv.XT_VECTOR|r.Rsrv.XT_HAS_ATTR:var o=i("names".length+3),s=i(o+r.determine_size(t.keys(e)));return i(s+a(t.values(e)));case r.Rsrv.XT_ARRAY_STR|r.Rsrv.XT_HAS_ATTR:return r.determine_size("0403556553")+4+4+"class".length+3+r.determine_size(["javascript_function"]);default:throw new r.RserveError("Internal error, can't handle type "+u)}},r.write_into_view=function(e,n,a,i){var u,o,s,f,c=r.determine_size(e,a),l=c>16777215,_=a||r.type_id(e);l&&(_|=r.Rsrv.XT_LARGE);var v,h=n.data_view();switch(l?(v=8,h.setInt32(0,_+(c-8<<8)),h.setInt32(4,c-8>>>24)):(v=4,h.setInt32(0,_+(c-4<<8))),_&~r.Rsrv.XT_LARGE){case r.Rsrv.XT_NULL:break;case r.Rsrv.XT_ARRAY_BOOL:if(t.isBoolean(e))h.setInt32(v,1),h.setInt8(v+4,e?1:0);else for(h.setInt32(v,e.length),u=0;u<e.length;++u)h.setInt8(v+4+u,e[u]?1:0);break;case r.Rsrv.XT_ARRAY_STR:if(t.isArray(e)){var d=v;t.each(e,(function(e){for(var r=unescape(encodeURIComponent(e)),t=0;t<r.length;++t,++d)h.setUint8(d,r.charCodeAt(t));h.setUint8(d++,0)}))}else{var p=unescape(encodeURIComponent(e));for(u=0;u<p.length;++u)h.setUint8(v+u,p.charCodeAt(u));h.setUint8(v+p.length,0)}break;case r.Rsrv.XT_ARRAY_DOUBLE:if(t.isNumber(e))h.setFloat64(v,e);else for(u=0;u<e.length;++u)h.setFloat64(v+8*u,e[u]);break;case r.Rsrv.XT_RAW:for(f=new r.EndianAwareDataView(e),h.setUint32(v,e.byteLength),u=0;u<e.byteLength;++u)h.setUint8(v+4+u,f.getUint8(u));break;case r.Rsrv.XT_VECTOR:case r.Rsrv.XT_LANG_NOTAG:o=v,t.each(e,(function(e){var t=r.determine_size(e);r.write_into_view(e,n.skip(o),void 0,i),o+=t}));break;case r.Rsrv.XT_VECTOR|r.Rsrv.XT_HAS_ATTR:for(o=v+8,t.each(t.keys(e),(function(e){for(var r=0;r<e.length;++r,++o)h.setUint8(o,e.charCodeAt(r));h.setUint8(o++,0)})),h.setUint32(v+4,r.Rsrv.XT_ARRAY_STR+(o-(v+8)<<8)),h.setUint32(o,r.Rsrv.XT_SYMNAME+2048),o+=4,s="names",u=0;u<s.length;++u,++o)h.setUint8(o,s.charCodeAt(u));o+=3,h.setUint32(v,r.Rsrv.XT_LIST_TAG+(o-(v+4)<<8)),t.each(t.values(e),(function(e){var t=r.determine_size(e);r.write_into_view(e,n.skip(o),void 0,i),o+=t}));break;case r.Rsrv.XT_ARRAY_STR|r.Rsrv.XT_HAS_ATTR:var R=i(e);o=v+8;var g="javascript_function";for(u=0;u<g.length;++u,++o)h.setUint8(o,g.charCodeAt(u));for(h.setUint8(o++,0),h.setUint32(8,r.Rsrv.XT_ARRAY_STR+(o-(v+8)<<8)),h.setUint32(o,r.Rsrv.XT_SYMNAME+2048),o+=4,s="class",u=0;u<s.length;++u,++o)h.setUint8(o,s.charCodeAt(u));for(o+=3,h.setUint32(4,r.Rsrv.XT_LIST_TAG+(o-(v+4)<<8)),u=0;u<R.length;++u)h.setUint8(o+u,R.charCodeAt(u));h.setUint8(o+R.length,0);break;default:throw new r.RserveError("Internal error, can't handle type "+_)}},r}();var i={RSClient:a};const u=e.createContext(null),o=({value:t,children:n})=>{const[a,o]=e.useState(u);return r((()=>{if(t.host)try{const e={...t,on_connect:()=>o(r)};let r=i.RSClient.create({...e})}catch(e){o(null),console.log(e)}}),[t]),e.createElement(u.Provider,{value:a},n)};function s(){return e.useContext(u)}const f=({host:r,children:t})=>e.createElement(o,{value:{host:r}},t);export{f as Rserve,s as useRserve};
