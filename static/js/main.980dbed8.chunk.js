(this["webpackJsonpreact-rserve-example"]=this["webpackJsonpreact-rserve-example"]||[]).push([[0],{10:function(e,t,r){var n=function(){var e={},t=r(12);return function(){function r(e,r){r=r||{json:function(){throw"json() unsupported for type "+this.type}};var n={json:function(n){var a=r.json.call(this,n);return a.r_type=e,t.isUndefined(this.attributes)||(a.r_attributes=t.object(t.map(this.attributes.value,(function(e){return[e.name,e.value.json(n)]})))),a}};return function(t,r){function a(){this.type=e,this.value=t,this.attributes=r}return a.prototype=n,new a}}e.Robj={null:function(e){return{type:"null",value:null,attributes:e,json:function(){return null}}},clos:function(e,t,r){return{type:"clos",value:{formals:e,body:t},attributes:r,json:function(){throw"json() unsupported for type clos"}}},vector:r("vector",{json:function(e){var r=t.map(this.value,(function(t){return t.json(e)}));if(t.isUndefined(this.attributes))return r;if("names"==this.attributes.value[0].name){var n=this.attributes.value[0].value.value,a={};return t.each(n,(function(e,t){a[e]=r[t]})),a}return r}}),symbol:r("symbol",{json:function(){return this.value}}),list:r("list"),lang:r("lang",{json:function(e){var r=t.map(this.value,(function(t){return t.json(e)}));if(t.isUndefined(this.attributes))return r;if("names"!=this.attributes.value[0].name)throw"expected names here";var n=this.attributes.value[0].value.value,a={};return t.each(n,(function(e,t){a[e]=r[t]})),a}}),tagged_list:r("tagged_list",{json:function(e){var r=this.value.slice(1);switch(function(e){return t.all(e,(function(e){return null===e.name}))?"plain_list":t.all(e,(function(e){return null!==e.name}))?"plain_object":"mixed_list"}(r)){case"plain_list":return t.map(r,(function(t){return t.value.json(e)}));case"plain_object":return t.object(t.map(r,(function(t){return[t.name,t.value.json(e)]})));case"mixed_list":return r;default:throw"Internal Error"}}}),tagged_lang:r("tagged_lang",{json:function(e){return t.map(this.value,(function(t){return[t.name,t.value.json(e)]}))}}),vector_exp:r("vector_exp"),int_array:r("int_array",{json:function(){if(this.attributes&&"tagged_list"===this.attributes.type&&"levels"===this.attributes.value[0].name&&"string_array"===this.attributes.value[0].value.type){var e=this.attributes.value[0].value.value,r=t.map(this.value,(function(t){return e[t-1]}));return r.levels=e,r}return 1===this.value.length?this.value[0]:this.value}}),double_array:r("double_array",{json:function(){return 1===this.value.length&&t.isUndefined(this.attributes)?this.value[0]:this.value}}),string_array:r("string_array",{json:function(e){return 1===this.value.length?t.isUndefined(this.attributes)?this.value[0]:"class"===this.attributes.value[0].name&&-1!==this.attributes.value[0].value.value.indexOf("javascript_function")?e(this.value[0]):this.value:this.value}}),bool_array:r("bool_array",{json:function(){return 1===this.value.length&&t.isUndefined(this.attributes)?this.value[0]:this.value}}),raw:r("raw",{json:function(){return 1===this.value.length&&t.isUndefined(this.attributes)?this.value[0]:this.value}}),string:r("string",{json:function(){return this.value}})}}(),e.Rsrv={PAR_TYPE:function(e){return 255&e},PAR_LEN:function(e){return e>>>8},PAR_LENGTH:function(e){return e>>>8},par_parse:function(t){return[e.Rsrv.PAR_TYPE(t),e.Rsrv.PAR_LEN(t)]},SET_PAR:function(e,t){return(16777215&t)<<8|255&e},CMD_STAT:function(e){return e>>>24&127},SET_STAT:function(e,t){return e|(127&t)<<24},IS_OOB_SEND:function(t){return(268431360&t)===e.Rsrv.OOB_SEND},IS_OOB_MSG:function(t){return(268431360&t)===e.Rsrv.OOB_MSG},OOB_USR_CODE:function(e){return 4095&e},CMD_RESP:65536,RESP_OK:65537,RESP_ERR:65538,OOB_SEND:135168,OOB_MSG:139264,ERR_auth_failed:65,ERR_conn_broken:66,ERR_inv_cmd:67,ERR_inv_par:68,ERR_Rerror:69,ERR_IOerror:70,ERR_notOpen:71,ERR_accessDenied:72,ERR_unsupportedCmd:73,ERR_unknownCmd:74,ERR_data_overflow:75,ERR_object_too_big:76,ERR_out_of_mem:77,ERR_ctrl_closed:78,ERR_session_busy:80,ERR_detach_failed:81,ERR_disabled:97,ERR_unavailable:98,ERR_cryptError:99,ERR_securityClose:100,CMD_login:1,CMD_voidEval:2,CMD_eval:3,CMD_shutdown:4,CMD_switch:5,CMD_keyReq:6,CMD_secLogin:7,CMD_OCcall:15,CMD_openFile:16,CMD_createFile:17,CMD_closeFile:18,CMD_readFile:19,CMD_writeFile:20,CMD_removeFile:21,CMD_setSEXP:32,CMD_assignSEXP:33,CMD_detachSession:48,CMD_detachedVoidEval:49,CMD_attachSession:50,CMD_ctrl:64,CMD_ctrlEval:66,CMD_ctrlSource:69,CMD_ctrlShutdown:68,CMD_setBufferSize:129,CMD_setEncoding:130,CMD_SPECIAL_MASK:240,CMD_serEval:245,CMD_serAssign:246,CMD_serEEval:247,DT_INT:1,DT_CHAR:2,DT_DOUBLE:3,DT_STRING:4,DT_BYTESTREAM:5,DT_SEXP:10,DT_ARRAY:11,DT_LARGE:64,XT_NULL:0,XT_INT:1,XT_DOUBLE:2,XT_STR:3,XT_LANG:4,XT_SYM:5,XT_BOOL:6,XT_S4:7,XT_VECTOR:16,XT_LIST:17,XT_CLOS:18,XT_SYMNAME:19,XT_LIST_NOTAG:20,XT_LIST_TAG:21,XT_LANG_NOTAG:22,XT_LANG_TAG:23,XT_VECTOR_EXP:26,XT_VECTOR_STR:27,XT_ARRAY_INT:32,XT_ARRAY_DOUBLE:33,XT_ARRAY_STR:34,XT_ARRAY_BOOL_UA:35,XT_ARRAY_BOOL:36,XT_RAW:37,XT_ARRAY_CPLX:38,XT_UNKNOWN:48,XT_LARGE:64,XT_HAS_ATTR:128,BOOL_TRUE:1,BOOL_FALSE:0,BOOL_NA:2,GET_XT:function(e){return 63&e},GET_DT:function(e){return 63&e},HAS_ATTR:function(t){return(t&e.Rsrv.XT_HAS_ATTR)>0},IS_LARGE:function(t){return(t&e.Rsrv.XT_LARGE)>0},status_codes:{65:"ERR_auth_failed",66:"ERR_conn_broken",67:"ERR_inv_cmd",68:"ERR_inv_par",69:"ERR_Rerror",70:"ERR_IOerror",71:"ERR_notOpen",72:"ERR_accessDenied",73:"ERR_unsupportedCmd",74:"ERR_unknownCmd",75:"ERR_data_overflow",76:"ERR_object_too_big",77:"ERR_out_of_mem",78:"ERR_ctrl_closed",80:"ERR_session_busy",81:"ERR_detach_failed",97:"ERR_disabled",98:"ERR_unavailable",99:"ERR_cryptError",100:"ERR_securityClose"}},function(){function r(r){var n={};function a(e,t){return function(r,n){return[e.call(u,r,n),t||n]}}function s(e,t){return function(r,n){var a=e.call(u,r,n),s=t(a[0])(r,n-a[1]);return[s[0],a[1]+s[1]]}}function i(e){if(1===e.length&&255===e.charCodeAt(0))return null;try{return decodeURIComponent(escape(e))}catch(t){throw new Error("Invalid UTF8: "+e)}}var o,u={offset:0,data_view:r.make(e.EndianAwareDataView),msg:r,read_int:function(){var e=this.offset;return this.offset+=4,this.data_view.getInt32(e)},read_string:function(e){for(var t="";e--;){var r=this.data_view.getInt8(this.offset++);r&&(t+=String.fromCharCode(r))}return i(t)},read_stream:function(e){var t=this.offset;return this.offset+=e,this.msg.view(t,e)},read_int_vector:function(e){var t=this.offset;return this.offset+=e,this.msg.make(Int32Array,t,e)},read_double_vector:function(e){var t=this.offset;return this.offset+=e,this.msg.make(Float64Array,t,e)},read_null:a((function(t,r){return e.Robj.null(t)})),read_unknown:a((function(t,r){return this.offset+=r,e.Robj.null(t)})),read_string_array:function(t,r){for(var n=this.read_stream(r).make(Uint8Array),a=[],s="",o=0;o<n.length;++o)0===n[o]?(s=i(s),a.push(s),s=""):s+=String.fromCharCode(n[o]);return[e.Robj.string_array(a,t),r]},read_bool_array:function(r,n){var a=this.read_int(),s=this.read_stream(n-4),i=t.map(s.make(Uint8Array).subarray(0,a),(function(e){return!!e}));return[e.Robj.bool_array(i,r),n]},read_raw:function(t,r){var n=this.read_int(),a=this.read_stream(r-4),s=new Uint8Array(a.make(Uint8Array).subarray(0,n)).buffer;return[e.Robj.raw(s,t),r]},read_sexp:function(){var t=this.read_int(),r=e.Rsrv.par_parse(t),a=r[0],s=r[1],i=4,o=void 0;e.Rsrv.IS_LARGE(a)&&(i+=4,s+=this.read_int()*Math.pow(2,24),a&=-65);if(a&e.Rsrv.XT_HAS_ATTR){a&=~e.Rsrv.XT_HAS_ATTR;var u=this.read_sexp();o=u[0],i+=u[1],s-=u[1]}if(void 0===n[a])throw new e.RserveError("Unimplemented "+a,-1);var _=n[a].call(this,o,s);return[_[0],i+_[1]]}};function _(e){for(var t=[],r=0;r<e.length;r+=2){var n=e[r],a=e[r+1];"symbol"===a.type?t.push({name:a.value,value:n}):t.push({name:null,value:n})}return t}function c(e,t){return s(e,(function(e){return a((function(r,n){return t(e,r)}),0)}))}function l(e,t){return a((function(r,n){return t(e.call(u,n),r)}))}return u.read_clos=s(u.read_sexp,(function(t){return s(u.read_sexp,(function(r){return a((function(n,a){return e.Robj.clos(t,r,n)}),0)}))})),u.read_list=(o=u.read_sexp,function(e,t){for(var r=[],n=t;t>0;){var a=o.call(u,e,t);r.push(a[0]),t-=a[1]}return[r,n]}),u.read_list_tag=s(u.read_list,(function(t){return a((function(r,n){var a=_(t);return e.Robj.tagged_list(a,r)}),0)})),u.read_lang_tag=s(u.read_list,(function(t){return a((function(r,n){var a=_(t);return e.Robj.tagged_lang(a,r)}),0)})),u.read_vector=c(u.read_list,e.Robj.vector),u.read_list_no_tag=c(u.read_list,e.Robj.list),u.read_lang_no_tag=c(u.read_list,e.Robj.lang),u.read_vector_exp=c(u.read_list,e.Robj.vector_exp),u.read_symname=l(u.read_string,e.Robj.symbol),u.read_int_array=l(u.read_int_vector,e.Robj.int_array),u.read_double_array=l(u.read_double_vector,e.Robj.double_array),n[e.Rsrv.XT_NULL]=u.read_null,n[e.Rsrv.XT_UNKNOWN]=u.read_unknown,n[e.Rsrv.XT_VECTOR]=u.read_vector,n[e.Rsrv.XT_CLOS]=u.read_clos,n[e.Rsrv.XT_SYMNAME]=u.read_symname,n[e.Rsrv.XT_LIST_NOTAG]=u.read_list_no_tag,n[e.Rsrv.XT_LIST_TAG]=u.read_list_tag,n[e.Rsrv.XT_LANG_NOTAG]=u.read_lang_no_tag,n[e.Rsrv.XT_LANG_TAG]=u.read_lang_tag,n[e.Rsrv.XT_VECTOR_EXP]=u.read_vector_exp,n[e.Rsrv.XT_ARRAY_INT]=u.read_int_array,n[e.Rsrv.XT_ARRAY_DOUBLE]=u.read_double_array,n[e.Rsrv.XT_ARRAY_STR]=u.read_string_array,n[e.Rsrv.XT_ARRAY_BOOL]=u.read_bool_array,n[e.Rsrv.XT_RAW]=u.read_raw,n[e.Rsrv.XT_STR]=l(u.read_string,e.Robj.string),u}var n=[],a=null,s=0,i=0;function o(){n=[],a=null,i=0,s=0}function u(t){var n=e.my_ArrayBufferView(t,16,t.byteLength-16);if(0===n.length)return null;var a=r(n),s=a.read_int(),i=e.Rsrv.par_parse(s),o=i[0],u=i[1];if(e.Rsrv.IS_LARGE(o)){if((u+=a.read_int()*Math.pow(2,24))>Math.pow(2,32))throw new Error("Payload too large: "+u+" bytes");o&=-65}if(o===e.Rsrv.DT_INT)return{type:"int",value:a.read_int()};if(o===e.Rsrv.DT_STRING)return{type:"string",value:a.read_string(u)};if(o===e.Rsrv.DT_BYTESTREAM)return{type:"stream",value:a.read_stream(u)};if(o===e.Rsrv.DT_SEXP){var _=(i=a.read_sexp())[0];i[1];return{type:"sexp",value:_}}throw new e.RserveError("Bad type for parse? "+o+" "+u,-1)}e.parse_websocket_frame=function(t){var r={};if(n.length){if(r.header=a,n.push(t),(i-=t.byteLength)<0)return r.ok=!1,r.message="Messages add up to more than expected length: got "+(s-i)+", expected "+s,o(),r;if(0!==i)return r.ok=!0,r.incomplete=!0,r;var _=new ArrayBuffer(s),c=new Uint8Array(_),l=0;if(n.forEach((function(e,t){c.set(new Uint8Array(e),l),l+=e.byteLength})),l!==s)return r.ok=!1,r.message="Internal error - frames added up to "+l+" not "+s,o(),r;o(),t=_}var f=new Int32Array(t,0,4),R=16777215&f[0],v=f[0]>>>24,d=f[1],h=f[3],g=f[2];if(r.header=[R,v,g],h)return r.ok=!1,r.message="rserve.js cannot handle messages larger than 4GB",r;var p=d+16;if(p>t.byteLength)return n.push(t),a=f,i=(s=p)-t.byteLength,r.header=f,r.ok=!0,r.incomplete=!0,r;if(R===e.Rsrv.RESP_ERR)return r.ok=!1,r.status_code=v,r.message="ERROR FROM R SERVER: "+(e.Rsrv.status_codes[v]||v)+" "+r.header[0]+" "+r.header[1]+" "+t.byteLength+" "+t,r;if(R!==e.Rsrv.RESP_OK&&!e.Rsrv.IS_OOB_SEND(R)&&!e.Rsrv.IS_OOB_MSG(R))return r.ok=!1,r.message="Unexpected response from Rserve: "+R+" status: "+e.Rsrv.status_codes[v],r;try{r.payload=u(t),r.ok=!0}catch(T){r.ok=!1,r.message=T.message}return r},e.parse_payload=u}(),function(){var r;!function(){var e=new ArrayBuffer(4),t=new Uint8Array(e),n=new Uint32Array(e);if(t[0]=1,1===n[0])r=!0;else{if(16777216!==n[0])throw"we're bizarro endian, refusing to continue";r=!1}}(),e.EndianAwareDataView=function(){for(var e={setInt8:function(e,t){return this.view.setInt8(e,t)},setUint8:function(e,t){return this.view.setUint8(e,t)},getInt8:function(e){return this.view.getInt8(e)},getUint8:function(e){return this.view.getUint8(e)}},t=["setInt32","setInt16","setUint32","setUint16","setFloat32","setFloat64"],n=["getInt32","getInt16","getUint32","getUint16","getFloat32","getFloat64"],a=0;a<t.length;++a){e[s=t[a]]=function(e){return function(t,n){return this.view[e](t,n,r)}}(s)}for(a=0;a<n.length;++a){var s;e[s=n[a]]=function(e){return function(t){return this.view[e](t,r)}}(s)}function i(e,t,r){void 0===t?0===e.byteLength?this.view={byteLength:0,byteOffset:0}:this.view=new DataView(e):this.view=new DataView(e,t,r)}return i.prototype=e,i}(),e.my_ArrayBufferView=function(r,n,a){return{buffer:r,offset:n=t.isUndefined(n)?0:n,length:a=t.isUndefined(a)?r.byteLength:a,data_view:function(){return new e.EndianAwareDataView(this.buffer,this.offset,this.buffer.byteLength-this.offset)},make:function(e,r,n){r=t.isUndefined(r)?0:r,n=t.isUndefined(n)?this.length:n;var a=e.BYTES_PER_ELEMENT||1,s=n/a;if((this.offset+r)%a!=0){for(var i=new DataView(this.buffer,this.offset+r,n),o=new ArrayBuffer(n),u=new DataView(o),_=0;_<n;++_)u.setUint8(_,i.getUint8(_));return new e(o)}return new e(this.buffer,this.offset+r,s)},skip:function(t){return e.my_ArrayBufferView(this.buffer,this.offset+t,this.buffer.byteLength)},view:function(t,r){var n=this.offset+t;if(n+r>this.buffer.byteLength)throw new Error("Rserve.my_ArrayBufferView.view: bounds error: size: "+this.buffer.byteLength+" offset: "+n+" length: "+r);return e.my_ArrayBufferView(this.buffer,n,r)}}}}(),function(){function r(r,n,a){t.isArray(n)||(n=[n]),a||(a=0);var s=t.reduce(n,(function(e,t){return e+t.byteLength}),0),i=new ArrayBuffer(16+s),o=new e.EndianAwareDataView(i);o.setInt32(0,r),o.setInt32(4,s),o.setInt32(8,a),o.setInt32(12,0);var u=16;return t.each(n,(function(e){for(var t=new Uint8Array(e),r=0;r<t.byteLength;++r)o.setUint8(u+r,t[r]);u+=e.byteLength})),i}function n(t){var r=t.length+1+3&-4,n=new ArrayBuffer(r+4),a=new e.EndianAwareDataView(n);a.setInt32(0,e.Rsrv.DT_STRING+(r<<8));for(var s=0;s<t.length;++s)a.setInt8(4+s,t.charCodeAt(s));return n}e.create=function(a){var s=(a=t.defaults(a||{},{host:"http://127.0.0.1:8081",on_connect:function(){}})).host,i=a.on_connect,o=new WebSocket(s);o.binaryType="arraybuffer";var u,_=a.on_error||function(t){throw new e.RserveError(t,-1)},c=!1,l={};function f(e){var t=function(){var e;do{e=String(Math.random()).slice(2,12)}while(e in l);if(10!==e.length)throw new Error("Bad rng, no cookie");return e}();return l[t]=e,t}function R(t,r){var n=e.determine_size(t,r);if(n>16777215){var a=new ArrayBuffer(n+8);return(s=e.my_ArrayBufferView(a)).data_view().setInt32(0,e.Rsrv.DT_SEXP+(16777215&n)*Math.pow(2,8)+e.Rsrv.DT_LARGE),s.data_view().setInt32(4,n>>>24),e.write_into_view(t,s.skip(8),r,f),a}var s;a=new ArrayBuffer(n+4);return(s=e.my_ArrayBufferView(a)).data_view().setInt32(0,e.Rsrv.DT_SEXP+(n<<8)),e.write_into_view(t,s.skip(4),r,f),a}function v(e,t,n){var s=r(e,t,n);return a.debug&&a.debug.message_out&&a.debug.message_out(s[0],e),o.send(s),s}o.onclose=function(e){u.running=!1,u.closed=!0,a.on_close&&a.on_close(e)},o.onmessage=function(r){if("Buffer"===r.data.constructor.name&&(r.data=new Uint8Array(r.data).buffer),a.debug&&a.debug.message_in&&a.debug.message_in(r),c)if("string"!==typeof r.data){var s=e.parse_websocket_frame(r.data);if(!s.incomplete){var o=s.header[2],l=16777215&s.header[0],f=t.find(g,(function(e){return e.msg_id==o}));if(f||(f=g[0]),s.ok)if(l===e.Rsrv.RESP_OK)f.result_callback(null,s.payload);else if(e.Rsrv.IS_OOB_SEND(l))a.on_data&&a.on_data(s.payload);else if(e.Rsrv.IS_OOB_MSG(l)){var p;f=e.Rsrv.OOB_USR_CODE(l)>255?h:d;try{p=e.wrap_all_ocaps(u,s.payload)}catch(b){return void v(e.Rsrv.RESP_ERR|l,n(String(b)),o)}if(t.isString(p[0]))t.isUndefined(a.on_oob_message)?v(e.Rsrv.RESP_ERR|l,n("No handler installed"),o):(f.in_oob_message=!0,a.on_oob_message(s.payload,(function(t,r){f.in_oob_message?(f.in_oob_message=!1,t?v(l|e.Rsrv.RESP_ERR,n(t),o):v(l|e.Rsrv.RESP_OK,n(r),o),T()):_("Don't call oob_message_handler more than once.")})));else if(t.isFunction(p[0]))if(u.ocap_mode){var A=p[0],E=p.slice(1);E.push((function(t,r){t?v(e.Rsrv.RESP_ERR|l,R(t),o):v(l,R(r),o)})),A.apply(void 0,E)}else v(e.Rsrv.RESP_ERROR|l,n("JavaScript function calls only allowed in ocap mode"),o);else v(e.Rsrv.RESP_ERROR|l,n("Unknown oob message type: "+typeof p[0]))}else _("Internal Error, parse returned unexpected type "+s.header[0],-1);else f.result_callback([s.message,s.status_code],void 0)}}else a.on_raw_string&&a.on_raw_string(r.data);else!function(t){if("string"===typeof(t=t.data))"Rsrv"!==t.substr(0,4)?_("server is not an RServe instance",-1):"0103"!==t.substr(4,4)?_("sorry, rserve only speaks the 0103 version of the R server protocol",-1):"QAP1"!==t.substr(8,4)?_("sorry, rserve only speaks QAP1",-1):(c=!0,a.login&&u.login(a.login),u.running=!0,i&&i.call(u));else{var r=new DataView(t),n=String.fromCharCode(r.getUint8(0))+String.fromCharCode(r.getUint8(1))+String.fromCharCode(r.getUint8(2))+String.fromCharCode(r.getUint8(3));"RsOC"===n?(c=!0,u.ocap_mode=!0,u.bare_ocap=e.parse_payload(t).value,u.ocap=e.wrap_ocap(u,u.bare_ocap),u.running=!0,i&&i.call(u)):_("Unrecognized server answer: "+n,-1)}}(r)};var d={queue:[],in_oob_message:!1,awaiting_result:!1,msg_id:0,name:"control"},h={queue:[],in_oob_message:!1,awaiting_result:!1,msg_id:1,name:"compute"},g=[d,h];function p(e){return!e.in_oob_message&&!e.awaiting_result&&e.queue.length}function T(){var e=t.filter(g,p);if(e.length)if(u.closed)_("Cannot send messages on a closed socket!",-1);else{var r=t.sortBy(e,(function(e){return e.queue[0].timestamp}))[0],n=r.queue.shift();r.result_callback=n.callback,r.awaiting_result=!0,a.debug&&a.debug.message_out&&a.debug.message_out(n.buffer,n.command),o.send(n.buffer)}}function A(e,t,n,a,s){return s||(s=g[0]),n=n||function(){},function(e,t,r,n){n.queue.push({buffer:e,callback:function(e,r){n.awaiting_result=!1,T(),t(e,r)},command:r,timestamp:Date.now()}),T()}(r(e,t,s.msg_id),n,a,s)}return u={ocap_mode:!1,running:!1,closed:!1,close:function(){o.close()},login:function(t,r){A(e.Rsrv.CMD_login,n(t),r,t)},eval:function(t,r){A(e.Rsrv.CMD_eval,n(t),r,t)},createFile:function(t,r){A(e.Rsrv.CMD_createFile,n(t),r,t)},writeFile:function(t,r){A(e.Rsrv.CMD_writeFile,function(t){var r=t.length,n=new ArrayBuffer(r+4),a=new e.EndianAwareDataView(n);a.setInt32(0,e.Rsrv.DT_BYTESTREAM+(r<<8));for(var s=0;s<t.length;++s)a.setInt8(4+s,t[s]);return n}(t),r,"")},closeFile:function(t){A(e.Rsrv.CMD_closeFile,new ArrayBuffer(0),t,"")},set:function(t,r,a){A(e.Rsrv.CMD_setSEXP,[n(t),R(r)],a,"")},OCcall:function(t,r,n){var a,s=!1;try{s|="OCref"===t.r_attributes.class,a=t[0]}catch(u){}if(!s)try{s|="OCref"===t.attributes.value[0].value.value[0],a=t.value[0]}catch(u){}if(s){var i=[a];i.push.apply(i,r);var o=64==a.charCodeAt(0)?h:d;A(e.Rsrv.CMD_OCcall,R(i,e.Rsrv.XT_LANG_NOTAG),n,"",o)}else n(new Error("Expected an ocap, instead got "+t),void 0)},wrap_ocap:function(t){return e.wrap_ocap(this,t)},resolve_hash:function(e){if(!(e in l))throw new Error("hash "+e+" not found.");return l[e]}}},e.wrap_all_ocaps=function(r,n){return function n(a){var s=a;if(t.isArray(a)&&a.r_attributes&&"OCref"==a.r_attributes.class)return e.wrap_ocap(r,a);if(t.isArray(a))(s=t.map(a,n)).r_type=a.r_type,s.r_attributes=a.r_attributes;else{if(t.isTypedArray(a))return a;if(t.isFunction(a))return a;if(a&&!t.isUndefined(a.byteLength)&&!t.isUndefined(a.slice))return a;t.isObject(a)&&(s=t.object(t.map(a,(function(e,t){return[t,n(e)]}))))}return s}(n=n.value.json(r.resolve_hash))},e.wrap_ocap=function(r,n){var a=function(){var a=t.toArray(arguments);if(!a.length||!t.isFunction(a[a.length-1]))throw new Error("forgot to pass continuation to ocap");var s=a.pop();r.OCcall(n,a,(function(n,a){t.isUndefined(a)||(a=e.wrap_all_ocaps(r,a)),s(n,a)}))};return a.bare_ocap=n,a}}(),e.RserveError=function(e,t){this.name="RserveError",this.message=e,this.status_code=t},e.RserveError.prototype=Object.create(Error),e.RserveError.prototype.constructor=e.RserveError,t.mixin({isTypedArray:function(e){return!!t.isObject(e)&&!t.isUndefined(e.byteLength)&&!t.isUndefined(e.BYTES_PER_ELEMENT)}}),e.type_id=function(r){if(t.isNull(r)||t.isUndefined(r))return e.Rsrv.XT_NULL;var n={boolean:e.Rsrv.XT_ARRAY_BOOL,number:e.Rsrv.XT_ARRAY_DOUBLE,string:e.Rsrv.XT_ARRAY_STR};if(!t.isUndefined(n[typeof r]))return n[typeof r];if(t.isTypedArray(r))return e.Rsrv.XT_ARRAY_DOUBLE;if(!t.isUndefined(r.byteLength)&&!t.isUndefined(r.slice))return e.Rsrv.XT_RAW;if(t.isArray(r)&&t.all(r,(function(e){return"string"===typeof e})))return e.Rsrv.XT_ARRAY_STR;if(t.isArray(r)&&t.all(r,(function(e){return"boolean"===typeof e})))return e.Rsrv.XT_ARRAY_BOOL;if(t.isArray(r))return e.Rsrv.XT_VECTOR;if(t.isFunction(r))return e.Rsrv.XT_ARRAY_STR|e.Rsrv.XT_HAS_ATTR;if(t.isObject(r))return e.Rsrv.XT_VECTOR|e.Rsrv.XT_HAS_ATTR;throw new e.RServeError("Value type unrecognized by Rserve: "+r)},e.determine_size=function(r,n){function a(r){return t.reduce(r,(function(t,r){return t+e.determine_size(r)}),0)}function s(e){return e>1<<24?e+8:e+4}var i=n||e.type_id(r);switch(i&~e.Rsrv.XT_LARGE){case e.Rsrv.XT_NULL:return s(0);case e.Rsrv.XT_ARRAY_BOOL:return t.isBoolean(r)?s(8):s(r.length+7&-4);case e.Rsrv.XT_ARRAY_STR:return t.isArray(r)?s(t.reduce(r,(function(e,t){return e+unescape(encodeURIComponent(t)).length+1}),0)):s(unescape(encodeURIComponent(r)).length+1);case e.Rsrv.XT_ARRAY_DOUBLE:return t.isNumber(r)?s(8):s(8*r.length);case e.Rsrv.XT_RAW:return s(4+r.byteLength);case e.Rsrv.XT_VECTOR:case e.Rsrv.XT_LANG_NOTAG:return s(a(r));case e.Rsrv.XT_VECTOR|e.Rsrv.XT_HAS_ATTR:var o=s("names".length+3),u=s(o+e.determine_size(t.keys(r)));return s(u+a(t.values(r)));case e.Rsrv.XT_ARRAY_STR|e.Rsrv.XT_HAS_ATTR:return e.determine_size("0403556553")+4+4+"class".length+3+e.determine_size(["javascript_function"]);default:throw new e.RserveError("Internal error, can't handle type "+i)}},e.write_into_view=function(r,n,a,s){var i,o,u,_,c=e.determine_size(r,a),l=c>16777215,f=a||e.type_id(r);l&&(f|=e.Rsrv.XT_LARGE);var R,v=n.data_view();switch(l?(R=8,v.setInt32(0,f+(c-8<<8)),v.setInt32(4,c-8>>>24)):(R=4,v.setInt32(0,f+(c-4<<8))),f&~e.Rsrv.XT_LARGE){case e.Rsrv.XT_NULL:break;case e.Rsrv.XT_ARRAY_BOOL:if(t.isBoolean(r))v.setInt32(R,1),v.setInt8(R+4,r?1:0);else for(v.setInt32(R,r.length),i=0;i<r.length;++i)v.setInt8(R+4+i,r[i]?1:0);break;case e.Rsrv.XT_ARRAY_STR:if(t.isArray(r)){var d=R;t.each(r,(function(e){for(var t=unescape(encodeURIComponent(e)),r=0;r<t.length;++r,++d)v.setUint8(d,t.charCodeAt(r));v.setUint8(d++,0)}))}else{var h=unescape(encodeURIComponent(r));for(i=0;i<h.length;++i)v.setUint8(R+i,h.charCodeAt(i));v.setUint8(R+h.length,0)}break;case e.Rsrv.XT_ARRAY_DOUBLE:if(t.isNumber(r))v.setFloat64(R,r);else for(i=0;i<r.length;++i)v.setFloat64(R+8*i,r[i]);break;case e.Rsrv.XT_RAW:for(_=new e.EndianAwareDataView(r),v.setUint32(R,r.byteLength),i=0;i<r.byteLength;++i)v.setUint8(R+4+i,_.getUint8(i));break;case e.Rsrv.XT_VECTOR:case e.Rsrv.XT_LANG_NOTAG:o=R,t.each(r,(function(t){var r=e.determine_size(t);e.write_into_view(t,n.skip(o),void 0,s),o+=r}));break;case e.Rsrv.XT_VECTOR|e.Rsrv.XT_HAS_ATTR:for(o=R+8,t.each(t.keys(r),(function(e){for(var t=0;t<e.length;++t,++o)v.setUint8(o,e.charCodeAt(t));v.setUint8(o++,0)})),v.setUint32(R+4,e.Rsrv.XT_ARRAY_STR+(o-(R+8)<<8)),v.setUint32(o,e.Rsrv.XT_SYMNAME+2048),o+=4,u="names",i=0;i<u.length;++i,++o)v.setUint8(o,u.charCodeAt(i));o+=3,v.setUint32(R,e.Rsrv.XT_LIST_TAG+(o-(R+4)<<8)),t.each(t.values(r),(function(t){var r=e.determine_size(t);e.write_into_view(t,n.skip(o),void 0,s),o+=r}));break;case e.Rsrv.XT_ARRAY_STR|e.Rsrv.XT_HAS_ATTR:var g=s(r);for(o=R+8,i=0;i<"javascript_function".length;++i,++o)v.setUint8(o,"javascript_function".charCodeAt(i));for(v.setUint8(o++,0),v.setUint32(8,e.Rsrv.XT_ARRAY_STR+(o-(R+8)<<8)),v.setUint32(o,e.Rsrv.XT_SYMNAME+2048),o+=4,u="class",i=0;i<u.length;++i,++o)v.setUint8(o,u.charCodeAt(i));for(o+=3,v.setUint32(4,e.Rsrv.XT_LIST_TAG+(o-(R+4)<<8)),i=0;i<g.length;++i)v.setUint8(o+i,g.charCodeAt(i));v.setUint8(o+g.length,0);break;default:throw new e.RserveError("Internal error, can't handle type "+f)}},e}();e.exports=n},13:function(e,t,r){"use strict";r.r(t);var n=r(1),a=r.n(n),s=r(3),i=r.n(s);function o(){return(o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var u=r(10),_=a.a.createContext({OCCall:function(){},bare_ocap:function(){},close:function(){},closed:!1,createFile:function(){},eval:function(){},login:function(){},ocap:function(){},ocap_mode:!0,resolve_hash:function(){},running:!1,set:function(){},wrap_ocap:function(){},writeFile:function(){}}),c=function(e){var t=e.value,r=e.children,n=a.a.useState(_),s=n[0],i=n[1];if(!s||!s.running)var c=o({},t,{on_connect:function(){return i(l)}}),l=u.create(o({},c));return a.a.createElement(_.Provider,{value:s},r)};var l=function(e){var t=e.host,r=e.children;return a.a.createElement(c,{value:{host:t}},r)},f=r(4),R=function(){var e=a.a.useContext(_),t=Object(n.useState)(""),r=Object(f.a)(t,2),s=r[0],i=r[1];return e.running&&(console.log(e),e.ocap((function(e,t){e&&console.error(e),t.rversion((function(e,t){e&&console.error(e),i(t)}))}))),a.a.createElement("div",null,a.a.createElement("h1",null,"Rserve-enabled app"),""===s?a.a.createElement("p",null,"Not connected"):a.a.createElement("p",null,"Connected to R version ",s))};i.a.render(a.a.createElement(l,{host:"ws://localhost:8081"},a.a.createElement(R,null)),document.getElementById("root"))},5:function(e,t,r){e.exports=r(13)}},[[5,1,2]]]);
//# sourceMappingURL=main.980dbed8.chunk.js.map